<% layout('layouts/app') %>
<div class="container mt-5">
  <div class="d-flex justify-content-between align-items-center">
    <h1>All Places</h1>
    <% if(currentUser) { %>
    <a
      href="/places/create"
      class="btn btn-primary d-flex justify-content-between align-items-center py-2"
      ><svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-geo-alt-fill"
        viewBox="0 0 16 16"
      >
        <path
          d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10m0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6"
        /></svg
    ></a>
    <% } %>
  </div>

  <ul class="row mt-4">
    <% for(const place of places) { %>
    <li class="col-md-4 mb-4 col-sm-6">
      <div class="card card-custom shadow-sm rounded overflow-hidden">
        <div class="card-img">
          <div
            class="carousel slide carousel-fade"
            data-bs-ride="carousel"
            id="<%= place._id %>"
          >
            <div class="carousel-inner">
              <% place.images.forEach((image, index)=> { %>
              <div
                class="carousel-item <%= index === 0 ? 'active': '' %>"
                data-bs-interval="4000"
              >
                <img
                  src="/images/<%= image.filename %>"
                  class="d-block w-100 img-fluid img-places"
                  alt="<%= place.title %>"
                />
              </div>
              <% }) %>
            </div>
            <% if (place.images.length > 1) { %>
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#<%= place._id %>"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#<%= place._id %>"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Next</span>
            </button>
            <% } %>
          </div>
        </div>
        <div class="card-body">
          <figure>
            <blockquote class="blockquote fs-5">
              <p class="card-title"><%= place.title %></p>
            </blockquote>
            <figcaption class="blockquote-footer fst-italic">
              <%= place.location %>
            </figcaption>
          </figure>
          <p class="card-text lead fs-6">
            <% if (place.description.length > 60) { %>
            <%=place.description.substring(0, 60) %>... <% } else { %>
            <%=place.description %> <% } %>
          </p>
          <a
            href="/places/<%= place._id %>"
            class="btn btn-primary fs-6 btn-card"
            >See Details
          </a>
        </div>
      </div>
    </li>
    <% } %>
  </ul>
</div>
